(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[532],{6837:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/case-study/contract_testing",function(){return s(4174)}])},9369:function(e,t,s){"use strict";var n=s(5893);s(7294);let i={logo:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("img",{src:"/transparent-logo-horizontal-mn.svg",style:{maxHeight:"5rem"},alt:"logo"})}),project:{link:"https://github.com/signet-framework/"},docsRepositoryBase:"https://github.com/signet-framework/case-study",footer:{text:""},editLink:{text:null},feedback:{content:null}};t.Z=i},4174:function(e,t,s){"use strict";s.r(t);var n=s(5893),i=s(2673),r=s(3931),a=s(9369);s(9966);var o=s(1151);s(5675);let c={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:t}=Object.assign({},(0,o.ah)(),e.components);return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)},pageOpts:{filePath:"pages/case-study/contract_testing.md",route:"/case-study/contract_testing",headings:[{depth:1,value:"Contract Testing",id:"contract-testing"},{depth:2,value:"Benefits of Contract Testing",id:"benefits-of-contract-testing"},{depth:2,value:"Weaknesses of Contract Testing",id:"weaknesses-of-contract-testing"},{depth:2,value:"Evaluating various forms of Contract Testing",id:"evaluating-various-forms-of-contract-testing"},{depth:3,value:"Schema vs. Semantics",id:"schema-vs-semantics"},{depth:3,value:"The source of truth",id:"the-source-of-truth"},{depth:4,value:"Consumer-driven",id:"consumer-driven"},{depth:4,value:"Provider-driven",id:"provider-driven"},{depth:4,value:"Spec-driven",id:"spec-driven"},{depth:2,value:"Existing Solutions",id:"existing-solutions"}],timestamp:1689906163e3,pageMap:[{kind:"Meta",data:{index:{title:"Home",display:"hidden",type:"page"},"case-study-header-link":{title:"Case Study",type:"page",href:"/case-study"},quickstart:"Quickstart","case-study":{title:"Case Study"},about:{title:"About",type:"page"},contact:{title:"Contact â†—",type:"page",href:"https://github.com/signet-framework/",newWindow:!0}}},{kind:"MdxPage",name:"about",route:"/about"},{kind:"Folder",name:"case-study",route:"/case-study",children:[{kind:"Meta",data:{background:"Background",contract_testing:"Contract Testing",signet_framework:"Signet Framework",design_decisions:"Design Decisions"}},{kind:"Folder",name:"background",route:"/case-study/background",children:[{kind:"Meta",data:{monoliths_and_microservices:"Monoliths and Microservices",challenges_testing_microservices:"Challenges Testing Microservices"}},{kind:"MdxPage",name:"challenges_testing_microservices",route:"/case-study/background/challenges_testing_microservices"},{kind:"MdxPage",name:"monoliths_and_microservices",route:"/case-study/background/monoliths_and_microservices"}]},{kind:"MdxPage",name:"contract_testing",route:"/case-study/contract_testing"},{kind:"Folder",name:"design_decisions",route:"/case-study/design_decisions",children:[{kind:"Meta",data:{provider_verification:"Provider Verification",central_document_repository:"Central Document Repository"}},{kind:"MdxPage",name:"central_document_repository",route:"/case-study/design_decisions/central_document_repository"},{kind:"MdxPage",name:"provider_verification",route:"/case-study/design_decisions/provider_verification"}]},{kind:"Folder",name:"signet_framework",route:"/case-study/signet_framework",children:[{kind:"Meta",data:{usecase:"Use Case"}},{kind:"MdxPage",name:"usecase",route:"/case-study/signet_framework/usecase"}]}]},{kind:"MdxPage",name:"case-study",route:"/case-study"},{kind:"MdxPage",name:"index",route:"/"},{kind:"Folder",name:"quickstart",route:"/quickstart",children:[{kind:"Meta",data:{style_guide:"Style Guide",folders:"Folders and _meta.json",embed_image:"Embed an Image",mdx_with_react:"MDX with React"}},{kind:"MdxPage",name:"embed_image",route:"/quickstart/embed_image"},{kind:"MdxPage",name:"folders",route:"/quickstart/folders"},{kind:"MdxPage",name:"mdx_with_react",route:"/quickstart/mdx_with_react"},{kind:"MdxPage",name:"style_guide",route:"/quickstart/style_guide"}]},{kind:"MdxPage",name:"quickstart",route:"/quickstart"}],flexsearch:{codeblocks:!0},title:"Contract Testing"},pageNextRoute:"/case-study/contract_testing",nextraLayout:r.ZP,themeConfig:a.Z};function h(e){let t=Object.assign({h1:"h1",p:"p",strong:"strong",h2:"h2",code:"code",ol:"ol",li:"li",h3:"h3",ul:"ul",pre:"pre",span:"span",h4:"h4",em:"em"},(0,o.ah)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{children:"Contract Testing"}),"\n",(0,n.jsx)(t.p,{children:"Many of the benefits of integration and E2E tests can also be achieved using contract tests.\nFurthermore, contract tests attempt to maintain independent service development cycles, while also allowing faster feedback loops than broadly-scoped tests can typically attain."}),"\n",(0,n.jsx)(t.p,{children:"The typical way to integration test two services is to spin up both services in the same environment, and cause the consumer service to make API calls to the provider service. If the provider service responds correctly, and the consumer service handles the responses correctly, the integration tests are successful."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"TODO: diagram here illustrating an integration test"})}),"\n",(0,n.jsxs)(t.p,{children:["During contract tests, the interactions between the consumer and provider services are described in a document called a ",(0,n.jsx)(t.strong,{children:"contract"}),". Both services can be individually tested to determine if they conform to the contract. If either service does not behave according to what is described in the contract, the test fails, and the team which owns the service is notified that their service will not integrate correctly with the other service."]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"TODO: diagram here illustrating a contract test"})}),"\n",(0,n.jsx)(t.h2,{id:"benefits-of-contract-testing",children:"Benefits of Contract Testing"}),"\n",(0,n.jsx)(t.p,{children:"Contract testing aims to maintain the independent deployability of each service. It allows a team to test that their service performs its side of an integration correctly, without the need to spin up the other service."}),"\n",(0,n.jsx)(t.p,{children:"Not only do contract tests decouple the development life-cycles of different teams, but they also provide much faster feedback than integration and E2E tests. Contract tests behave more like unit test or service tests, and can be run quickly, cheaply, and early on in the CI/CD pipeline. They are lightweight enough that a developer could even run them locally before initiating the build processes. (much of the content of this paragraph is duplicated above...)"}),"\n",(0,n.jsxs)(t.p,{children:["Another benefit of contract tests is that they provide more fine-grained feedback than most integraion and E2E tests. Becuase each interaction in the contract is tested individually, when a contract test fails, the devoloper is informed of exactly which request or response was missing or malformed. (We don't focus on this as a problem in the ",(0,n.jsx)(t.code,{children:"background"})," section... maybe add it?)"]}),"\n",(0,n.jsx)(t.h2,{id:"weaknesses-of-contract-testing",children:"Weaknesses of Contract Testing"}),"\n",(0,n.jsx)(t.p,{children:"While contract tests reduce the need for broadly-scoped tests, they do not replace them entirely. Integration and E2E test provide a lot of confidence because they try to re-create production conditions as accurately as possible. Contract tests are not designed to replicate conditions like latency, service unavailability, and high amounts of load. Ideally, contract tests can reduce the dependence on E2E tests enough that they can be run asynchronously from the CI/CD pipeline. Successful implementation of contract testing increases the independence of teams, while still maintaining a high degree of confidence that breaking changes will be caught early on."}),"\n",(0,n.jsx)(t.p,{children:"Another trade-off with contract testing is that it usually requires a large startup cost at the beginning. Some forms of contract testing require swaths of new unit tests to be written. In these cases, an organization does not get the confidence benefit of contract testing until the new unit tests cover the majority of the service's interface."}),"\n",(0,n.jsx)(t.h2,{id:"evaluating-various-forms-of-contract-testing",children:"Evaluating various forms of Contract Testing"}),"\n",(0,n.jsx)(t.p,{children:"There are many approaches to contract testing, and each vendor has a slightly different take on how it should be conducted. The different methodologies can generally be classified according to how they answer two questions:"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsx)(t.li,{children:"Does the contract test care about schema or sementics?"}),"\n",(0,n.jsx)(t.li,{children:"What is the ultimate source of truth that defines what the integration should look like?\n(who gets to decided what is in the contract? how is the contract generated?)"}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"schema-vs-semantics",children:"Schema vs. Semantics"}),"\n",(0,n.jsx)(t.p,{children:"Contract tests are intended to catch inintended changes to the integration that will cause the consumer service to break. The breaking change can occur in either the consumer or the provider service. Contract tests can be categorized according to the type of breaking change they screen for:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Schema change"}),"\xa0- a change to the structure of a message"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Semantic change"}),"\xa0- a change to the meaning of a message"]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:'(I think it is probably worth cutting the section below... or at least having a more concise example)\nSuppose we have a consumer service that wants to know the Date of Birth for a specific user. The service uses HTTP, and makes a request to the "Users" microservice that looks like this:'}),"\n",(0,n.jsx)(t.pre,{"data-language":"text","data-theme":"default",children:(0,n.jsx)(t.code,{"data-language":"text","data-theme":"default",children:(0,n.jsx)(t.span,{className:"line",children:(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"GET /users/date-of-birth?username=catowner22"})})})}),"\n",(0,n.jsx)(t.p,{children:'The consumer service is expecting the "Users" service to respond with a payload like this:'}),"\n",(0,n.jsx)(t.pre,{"data-language":"json","data-theme":"default",children:(0,n.jsxs)(t.code,{"data-language":"json","data-theme":"default",children:[(0,n.jsx)(t.span,{className:"line",children:(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"{"})}),"\n",(0,n.jsxs)(t.span,{className:"line",children:[(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:'"username"'}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"catowner22"'}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsxs)(t.span,{className:"line",children:[(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:'"dob"'}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"7-10-1998"'})]}),"\n",(0,n.jsx)(t.span,{className:"line",children:(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,n.jsx)(t.p,{children:"Instead of giving the DOB as a string, what if the provider returns a number instead--the date in  milliseconds since the UNIX epoch:"}),"\n",(0,n.jsx)(t.pre,{"data-language":"json","data-theme":"default",children:(0,n.jsxs)(t.code,{"data-language":"json","data-theme":"default",children:[(0,n.jsx)(t.span,{className:"line",children:(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"{"})}),"\n",(0,n.jsxs)(t.span,{className:"line",children:[(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:'"username"'}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"catowner22"'}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsxs)(t.span,{className:"line",children:[(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:'"dob"'}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-constant)"},children:"900028800000"})]}),"\n",(0,n.jsx)(t.span,{className:"line",children:(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,n.jsx)(t.p,{children:"This is a schema change--the meaning of the value is the same, but its format is different."}),"\n",(0,n.jsx)(t.p,{children:'Instead, what if the "Users" service response with a different date?'}),"\n",(0,n.jsx)(t.pre,{"data-language":"json","data-theme":"default",children:(0,n.jsxs)(t.code,{"data-language":"json","data-theme":"default",children:[(0,n.jsx)(t.span,{className:"line",children:(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"{"})}),"\n",(0,n.jsxs)(t.span,{className:"line",children:[(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:'"username"'}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"catowner22"'}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsxs)(t.span,{className:"line",children:[(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:'"dob"'}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(t.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"1-23-2005"'})]}),"\n",(0,n.jsx)(t.span,{className:"line",children:(0,n.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,n.jsx)(t.p,{children:"This constitutes a semantic change--the value has the same format, but the meaning of the value is different."}),"\n",(0,n.jsx)(t.p,{children:"Some styles of contract testing are purely schema-based. They don't check what the values in a message are, they only check that the structure of the message is correct. Contract tests that also verify the semantics provide more confidence. They are able to catch more breaking changes than purely schema based tests. The drawback to semantic tests is that they often require significant work to implement. Contract testing methodologies that require writing a bunch of new tests are usually the ones that care about message semantics, which is why the tests cannot be easily automated."}),"\n",(0,n.jsx)(t.h3,{id:"the-source-of-truth",children:"The source of truth"}),"\n",(0,n.jsx)(t.p,{children:"The other key differentiator between methodologies is how they determine the ultimate source of truth. When a contract test fails, how do we know what the integration should actually look like? Existing solutions generally fall into one of three categories (some vendors offer multiple products that belong to different buckets):"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Consumer-driven - the consumer service is the source of truth"}),"\n",(0,n.jsx)(t.li,{children:"Provider-driven - the provider service is the source of truth"}),"\n",(0,n.jsx)(t.li,{children:"Spec-driven - the source of truth is seperate from either service's implementation"}),"\n"]}),"\n",(0,n.jsx)(t.h4,{id:"consumer-driven",children:"Consumer-driven"}),"\n",(0,n.jsx)(t.p,{children:"In consumer-driven contract testing, the consumer service is implemented first. After the consumer team has implemented their side of the integration, they use unit tests to generate a consumer contract, which describes the expectations that the consumer service has of the provider service. The consumer contract is handed over to the provider team, and they implement the provider service's interface to satisfy the needs of the consumer."}),"\n",(0,n.jsx)(t.p,{children:"One advantage of a consumer-driven approach is that the contract only includes the parts of the provider's API which are actually being used. This gives the provider team insight into how they can evolve their API without breaking the consumers."}),"\n",(0,n.jsxs)(t.p,{children:["Another benefit of consumer-driven contracts is they typically describe the ",(0,n.jsx)(t.em,{children:"semantic"})," details. The actual requests the consumer makes and the responses the consumer expects are recorded in the contract. When the provider is verified against the contract, the requests are ",(0,n.jsx)(t.em,{children:"replayed"})," against the provider service. As far as contract tests go, this methodology yields the most confidence that the services integrate correctly."]}),"\n",(0,n.jsx)(t.p,{children:"Although a consumer-driven approach has clear benefits, it also comes with significant trade-offs. Perhaps the biggest one is that it undermines independent deployability for consumer services. When a consumer service is updated, a new consumer contract is generated. Before the consumer service can be deployed, the consumer contract must be pulled down by the provider team, the provider service must be spun up, and the interactions in the contract must be repayed against the provider. After that, the results of the test must be sent back over to the consumer team. Only when the consumer team is notified of a successful test are they able to proceed to deploying the new version of the consumer. In the event that provider verification fails, either the consumer team must fix the issue and start the process over again, or they must wait for the provider team to update their API to satisfy the contract."}),"\n",(0,n.jsx)(t.p,{children:"In either case, the consumer team does not get immediate feedback about whether their service is compatible with the provider. The provider team has to be involved. Taking into account that microservices often have multiple external dependencies, performing consumer-driven contract testing requires coordination from multiple teams any time a service is updated."}),"\n",(0,n.jsx)(t.p,{children:"(Two more drawbacks that are not mentioned for brevity):"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"(-) workflow is unintuitive, and does not align with how most teams agree on APIs"}),"\n",(0,n.jsx)(t.li,{children:"(-) consumer must be implemented first"}),"\n"]}),"\n",(0,n.jsx)(t.h4,{id:"provider-driven",children:"Provider-driven"}),"\n",(0,n.jsx)(t.p,{children:"Provider-driven contract testing is nearly the reverse of consumer-driven. The provider service is implemented first, and a provider contract is generated that describes the provider's side of the integration. Usually the provider contract comes in the form of an API specification, other times the provider team distributes a test-double which consumers can test against."}),"\n",(0,n.jsx)(t.p,{children:"The main benefit of a provider-driven approach is that it gives the provider team authority over what the integration must look like. Whether or not this is a good fit is specific to the organization, and depends on the roles of the services involved. Many organizations prefer a more collaberative approach to API design, where consumer and provider teams work together."}),"\n",(0,n.jsx)(t.p,{children:"Provider-driven contract tests are mainly schema-based, unless significant effort is expended to tailor the contract (or test double) to all of the consumers involved. It is natural to describe an API in terms of the schema is requires and the general behaviors it is capable of. However, it is difficult-to-impossible to exhaustively describe the semantics of every possible interaction with the API. Creating specific test cases requires knowledge of a given consumers needs, and a provider contract is not a natural fit for that purpose."}),"\n",(0,n.jsx)(t.h4,{id:"spec-driven",children:"Spec-driven"}),"\n",(0,n.jsx)(t.p,{children:'Spec-driven contract testing (a.k.a. "contract-driven" or "law-driven") occurs when the API spec is defined independently of either service\'s implementation. Usually this means that the API spec is agreed upon by both teams, and then both of them are individually responsible for correctly implementing what was agreed upon.'}),"\n",(0,n.jsx)(t.p,{children:"This approach flows naturally out of Spec-first API design, a practice where the provider team decides on a spec before writing the code, instead of documenting their implementation after it is completed. This design philosophy is beneficial becuase it allows both the consumer and provider services to be implemented simultaneously. As each service finishes implemenation, it can be independently tested against the API spec to verify that it will integrate correctly with the other service."}),"\n",(0,n.jsx)(t.p,{children:"Spec-driven contract testing is the most conducive to independent deployability. The API spec is decided at the beginning, and both services can be tested against the spec independently. Neither team needs help from the other to test the integration. As long as the both teams require every new version of their service to be tested for conformance to the spec, the life-cycles of the two services remain decoupled."}),"\n",(0,n.jsx)(t.h2,{id:"existing-solutions",children:"Existing Solutions"}),"\n",(0,n.jsx)(t.p,{children:"Should we only focus on spec-driven ones?"})]})}t.default=(0,i.j)(c)}},function(e){e.O(0,[533,774,888,179],function(){return e(e.s=6837)}),_N_E=e.O()}]);